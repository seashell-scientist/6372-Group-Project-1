---
title: "6372 EDA moviedata"
author: "Jonathan Tan"
date: "9/17/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r import}
#insert your movie database file here

mdata <- readxl::read_xlsx("D:/SMU/DS 6372 Applied Statistics/Sample Datasets/2014 and 2015 CSM dataset.xlsx")
names(mdata)[14]= "Aggregate_Followers" #the space was interfering with some loops
#names(mdata)


#adding Return as gross/budget, interpret as what % profit the movie made based off its budget
Return <- mdata$Gross/mdata$Budget
mdata <- cbind(mdata, Return)
head(mdata)
```

```{r inital visualizations}
library(ggplot2)

ggplot(data = mdata, aes(x = Ratings, y = Gross))+
  geom_bin2d(bins = 20)+
  labs(title = "Movie Ratings VS Gross")
```

```{r vis2}
ggplot()+
  geom_histogram(data = mdata, aes(x = Screens, fill = I("Blue")), binwidth = 40)

ggplot(data = mdata, aes(x = Screens, y = Gross))+
  geom_line()
```


```{r vis3}
ggplot(data = mdata, aes(x = Budget, y = Gross, color = factor(Year)))+
  geom_line(linejoin = "round")
 
ggplot(data = mdata, aes(sample = Gross, color = Year))+
  geom_qq()
```

```{r vis4}
#install.packages("ggpubr")
library(ggpubr)
ggboxplot(mdata, x = "Budget", y = "Gross", color = "Genre")
```

```{r vis5}
ggline(mdata, x = "Genre", y = "Return", 
       add = c("mean_se", "dotplot"))
```

roughly positive correlation between gross and rating, screens obviously positively correlates with gross. 

the distribution isn't normal, lots of small presumably indie films that didn't make much gross or have many theater showings, and a few huge blockbusters

high levels of return are genres 3, 8, and 15, with some 1 and 6

```{r check assumptions}
#par(mfrow=(c(2, 2)))
#qqnorm(mdata$Gross, main = "Gross")
#qqnorm(mdata$Budget, main = "Budget")
#
#profit <- mdata$Gross / mdata$Budget
#expense <- mdata$Budget/mdata$Gross
#
#qqnorm(profit, main = " Gross / Budget")
#qqnorm(expense, main = "Budget / Gross")
#
#
#
#qqnorm(log(mdata$Gross), main =  "Log(Gross)")
#qqnorm(log(mdata$Budget), main = "Log(Budget)")
#qqnorm(log(profit), main = " Log(Gross / Budget)" )
#qqnorm(log(expense), main = "Log (Budget / Gross" )

#qqnorm(log(mdata$Gross)/log(mdata$Budget), main = "log Gross / Log Budget")
```




```{r prelim model1}
#m1 <- lm(Gross ~ Budget + Screens, data = mdata)

#summary(m1)
#layout(matrix(c(1, 2, 3, 4), 2, 2)) 
#plot(m1)
```

```{r prelim model2}
#m2 <- lm(Gross ~ Budget + Screens + Budget*Screens, data = mdata)
##with multvar
#summary(m2)
#layout(matrix(c(1, 2, 3, 4), 2, 2)) 
#plot(m2)
```

```{r anova thing}
library(dplyr)
str(mdata)

#shotgun1
anov1 <- aov(Gross ~ Genre + Budget + Year + Sequel + Screens + Ratings + Likes + Sequel*Year + Ratings*Likes +Genre*Year, data = mdata)
summary(anov1)

#shotgun2
anov2 <- aov(Return ~ Genre + Budget + Year + Sequel + Screens + Ratings + Likes + Sequel*Year + Ratings*Likes +Genre*Year, data = mdata)
summary(anov2)

#shotgun3
anov3 <- aov(Return ~ Genre + Budget + Year + Sequel + Screens + Ratings + Likes + Views + Dislikes + Aggregate_Followers + Sentiment*Views + Screens*Budget + Return*Ratings + Sequel*Year + Ratings*Likes +Genre*Year, data = mdata)
summary(anov3)

```
For Gross (unlogged)
looks like genre, budget, screens and ratings are all significant factors, sequel and year:sequel less so


for Return (Gross/Budget), 
looks like genre, genre:year is significant, as is rating:likes
surprisingly not budget? 

```{r fit model based on anova variable selection thing?}
alm1 <- lm(Return ~ Genre + Ratings*Likes + Genre*Year, data = mdata)
summary(alm)
```

```{r compare models}
#compare ASE scores, plus more
#then format into table, model 1 v 2 with score metrics in columns
```









